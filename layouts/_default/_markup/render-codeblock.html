{{/* Get the code fence language from attributes (works across Hugo versions) */}}
{{- $lang := .Attributes.lang | default "" | lower -}}

{{- if eq $lang "mermaid" -}}
  <div class="mermaid">
    {{ .Inner | safeHTML }}
  </div>
{{- else -}}
  <pre><code{{ if $lang }} class="language-{{ $lang }}"{{ end }}>{{ .Inner | htmlEscape }}</code></pre>
{{- end -}}
